<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick LaTeX Renderer</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #f0f2f5;
            --surface-color: #ffffff;
            --border-color: #e1e4e8;
            --text-main: #24292f;
            --text-muted: #57606a;
            --primary-color: #0969da;
            --primary-hover: #035fc7;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.04);
            --shadow-lg: 0 12px 28px rgba(0,0,0,0.08);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 3rem 2rem;
            margin: 0;
            min-height: 100vh;
            box-sizing: border-box;
        }

        h1 { 
            margin-top: 0;
            margin-bottom: 2.5rem; 
            font-weight: 600;
            letter-spacing: -0.5px;
        }

        .app-container {
            display: flex;
            width: 100%;
            max-width: 1200px;
            gap: 2rem;
        }

        /* --- Editor & Toolbar --- */
        .editor-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--surface-color);
            border-radius: 16px;
            box-shadow: var(--shadow-lg);
            transition: box-shadow 0.2s ease;
        }

        .editor-section:focus-within {
            box-shadow: 0 0 0 3px rgba(9, 105, 218, 0.3), var(--shadow-lg);
        }

        .toolbar {
            display: flex;
            justify-content: center;
            flex-wrap: wrap; /* Allows buttons to wrap on smaller screens */
            gap: 12px;
            padding: 12px 20px;
            background: #fafbfc;
            border-bottom: 1px solid var(--border-color);
            border-radius: 16px 16px 0 0;
        }

        .toolbar-btn {
            background-color: transparent;
            color: var(--text-main);
            padding: 8px 14px;
            font-size: 0.95rem;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            border: 1px solid #8c959f; /* Made the border noticeably darker */
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .toolbar-btn:hover { background-color: #eaeef2; }

        textarea {
            flex: 1;
            min-height: 450px;
            padding: 24px;
            border: none;
            border-radius: 0 0 16px 16px;
            font-size: 15px;
            font-family: 'Fira Code', monospace;
            line-height: 1.6;
            color: var(--text-main);
            resize: vertical;
            outline: none;
            background: transparent;
        }

        textarea::placeholder {
            color: #9ca3af;
        }

        /* --- Output Box --- */
        .output-box {
            flex: 1;
            min-height: 450px;
            padding: 30px;
            border-radius: 16px;
            box-shadow: var(--shadow-lg);
            background-color: var(--surface-color);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow-y: auto;
            border: 1px solid var(--border-color);
        }

        .katex { font-size: 1.3em; }
        .katex-error { color: #cf222e; }

        /* --- General Modal Styling --- */
        .modal-overlay {
            display: none; 
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 100;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .modal-content.small-modal {
            max-width: 500px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-muted);
            padding: 0;
            line-height: 1;
        }

        .close-btn:hover { color: black; }

        .modal-body {
            padding: 1.5rem;
            overflow-y: auto;
        }

        .modal-footer {
            padding: 1.25rem 1.5rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            background: #fafbfc;
            border-radius: 0 0 12px 12px;
            flex-shrink: 0;
        }

        /* --- Buttons inside Modals --- */
        .btn {
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            cursor: pointer;
            border: none;
        }

        .btn-secondary { background-color: #8c959f; color: white; }
        .btn-secondary:hover { background-color: #768390; }

        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-primary:hover { background-color: var(--primary-hover); }

        /* --- Matrix Generator Specifics --- */
        .matrix-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .matrix-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #e9ecef;
            padding: 0.75rem 0.5rem;
            border-radius: 8px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }

        .matrix-option:hover { background: #dee2e6; }

        .matrix-option input[type="radio"] {
            margin-bottom: 6px;
            transform: scale(1.1);
            cursor: pointer;
        }

        .matrix-option:has(input[type="radio"]:checked) {
            border-color: var(--primary-color);
            background: #f0f7ff;
        }

        .matrix-preview {
            font-size: 1.05rem;
            pointer-events: none; 
        }

        .form-group {
            margin-bottom: 1rem;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .form-group label {
            font-weight: 600;
            font-size: 1rem;
        }

        .form-group input[type="number"] {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            font-family: 'Fira Code', monospace;
            outline: none;
        }

        .form-group input[type="number"]:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(9, 105, 218, 0.2);
        }

        /* --- Cheatsheet Table Formatting --- */
        .color-box-title h2 { margin-bottom: 0.5rem; margin-top: 1.5rem; }
        .color-box-table { width: 100%; border-collapse: collapse; margin-bottom: 1rem; }
        .color-box-table th, .color-box-table td { padding: 10px; text-align: left; border-bottom: 1px solid #eee; }
        .color-box-table th { font-weight: 600; color: var(--text-muted); }
        .color-box { width: 24px; height: 24px; border-radius: 4px; border: 1px solid rgba(0,0,0,0.15); }
    </style>
</head>
<body>

    <h1>Quick LaTeX Renderer</h1>

    <div class="app-container">
        <div class="editor-section">
            <div class="toolbar">
                <button class="toolbar-btn" id="open-matrix-btn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="3" y1="15" x2="21" y2="15"></line><line x1="9" y1="3" x2="9" y2="21"></line><line x1="15" y1="3" x2="15" y2="21"></line></svg>
                    Matrices
                </button>
                <button class="toolbar-btn" id="insert-piecewise-btn">Piecewise Function</button>
                <button class="toolbar-btn" id="open-cheatsheet-btn">Colors</button>
            </div>
            <textarea id="latex-input" placeholder="Enter your code here..." spellcheck="false"></textarea>
        </div>

        <div id="latex-output" class="output-box"></div>
    </div>

    <div class="modal-overlay" id="matrix-modal">
        <div class="modal-content small-modal">
            <div class="modal-header">
                <h2>Matrices</h2>
                <button class="close-btn" id="close-matrix-x">&times;</button>
            </div>
            <div class="modal-body">
                
                <div class="matrix-grid">
                    <label class="matrix-option">
                        <input type="radio" name="matrix-type" value="matrix">
                        <span class="matrix-preview" data-latex="\begin{matrix} 1 & 2 & 3 \\ 4 & 5 & 6 \\ 7 & 8 & 9 \end{matrix}"></span>
                    </label>
                    
                    <label class="matrix-option">
                        <input type="radio" name="matrix-type" value="pmatrix" checked>
                        <span class="matrix-preview" data-latex="\begin{pmatrix} 1 & 2 & 3 \\ 4 & 5 & 6 \\ 7 & 8 & 9 \end{pmatrix}"></span>
                    </label>

                    <label class="matrix-option">
                        <input type="radio" name="matrix-type" value="bmatrix">
                        <span class="matrix-preview" data-latex="\begin{bmatrix} 1 & 2 & 3 \\ 4 & 5 & 6 \\ 7 & 8 & 9 \end{bmatrix}"></span>
                    </label>

                    <label class="matrix-option">
                        <input type="radio" name="matrix-type" value="vmatrix">
                        <span class="matrix-preview" data-latex="\begin{vmatrix} 1 & 2 & 3 \\ 4 & 5 & 6 \\ 7 & 8 & 9 \end{vmatrix}"></span>
                    </label>

                    <label class="matrix-option">
                        <input type="radio" name="matrix-type" value="Vmatrix">
                        <span class="matrix-preview" data-latex="\begin{Vmatrix} 1 & 2 & 3 \\ 4 & 5 & 6 \\ 7 & 8 & 9 \end{Vmatrix}"></span>
                    </label>

                    <label class="matrix-option">
                        <input type="radio" name="matrix-type" value="Bmatrix">
                        <span class="matrix-preview" data-latex="\begin{Bmatrix} 1 & 2 & 3 \\ 4 & 5 & 6 \\ 7 & 8 & 9 \end{Bmatrix}"></span>
                    </label>
                </div>

                <div class="form-group">
                    <label for="mat-rows">Rows:</label>
                    <input type="number" id="mat-rows" value="3" min="1" max="20">
                </div>
                <div class="form-group">
                    <label for="mat-cols">Columns:</label>
                    <input type="number" id="mat-cols" value="3" min="1" max="20">
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" id="close-matrix-btn">Close</button>
                <button class="btn btn-primary" id="apply-matrix-btn">Apply</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="cheatsheet-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>LaTeX Colors Cheatsheet</h2>
                <button class="close-btn" id="close-cheatsheet-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="examples-box">
                    <h3 style="margin-top:0;">How to use colors:</h3>
                    <p><strong>Color specific text by Name:</strong> <code>\textcolor{blue}{your text here}</code></p>
                    <p><strong>Color specific text by HEX (Best for dvipsnames):</strong> <code>\textcolor{#F7921D}{your text here}</code></p>
                    <p><strong>Color all math after command:</strong> <code>\color{red} x = y + 2</code></p>
                </div>

                <div style="text-align:left">
                    <div class="color-box-title"><h2>Base colors</h2></div>
                    <table class="color-box-table">
                        <tbody><tr><th>color</th><th>name</th><th>HEX</th><th>RGB</th></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #000000"></div></td><td>black</td><td>#000000</td><td>rgb(0, 0, 0)</td></tr>
                        <tr><td><div class="color-box" style="background: #0000FF"></div></td><td>blue</td><td>#0000FF</td><td>rgb(0, 0, 255)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #A52A2A"></div></td><td>brown</td><td>#A52A2A</td><td>rgb(165, 42, 42)</td></tr>
                        <tr><td><div class="color-box" style="background: #00FFFF"></div></td><td>cyan</td><td>#00FFFF</td><td>rgb(0, 255, 255)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #A9A9A9"></div></td><td>darkgray</td><td>#A9A9A9</td><td>rgb(169, 169, 169)</td></tr>
                        <tr><td><div class="color-box" style="background: #808080"></div></td><td>gray</td><td>#808080</td><td>rgb(128, 128, 128)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #008000"></div></td><td>green</td><td>#008000</td><td>rgb(0, 128, 0)</td></tr>
                        <tr><td><div class="color-box" style="background: #D3D3D3"></div></td><td>lightgray</td><td>#D3D3D3</td><td>rgb(211, 211, 211)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #00FF00"></div></td><td>lime</td><td>#00FF00</td><td>rgb(0, 255, 0)</td></tr>
                        <tr><td><div class="color-box" style="background: #FF00FF"></div></td><td>magenta</td><td>#FF00FF</td><td>rgb(255, 0, 255)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #808000"></div></td><td>olive</td><td>#808000</td><td>rgb(128, 128, 0)</td></tr>
                        <tr><td><div class="color-box" style="background: #FFA500"></div></td><td>orange</td><td>#FFA500</td><td>rgb(255, 165, 0)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #FFC0CB"></div></td><td>pink</td><td>#FFC0CB</td><td>rgb(255, 192, 203)</td></tr>
                        <tr><td><div class="color-box" style="background: #800080"></div></td><td>purple</td><td>#800080</td><td>rgb(128, 0, 128)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #FF0000"></div></td><td>red</td><td>#FF0000</td><td>rgb(255, 0, 0)</td></tr>
                        <tr><td><div class="color-box" style="background: #008080"></div></td><td>teal</td><td>#008080</td><td>rgb(0, 128, 128)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #EE82EE"></div></td><td>violet</td><td>#EE82EE</td><td>rgb(238, 130, 238)</td></tr>
                        <tr><td><div class="color-box" style="background: #FFFFFF"></div></td><td>white</td><td>#FFFFFF</td><td>rgb(255, 255, 255)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #FFFF00"></div></td><td>yellow</td><td>#FFFF00</td><td>rgb(255, 255, 0)</td></tr>
                    </tbody></table>
                    <hr>
                    <div class="color-box-title"><h2>Colors via dvipsnames option</h2></div>
                    <table class="color-box-table">
                        <tbody><tr class="color-box-table-title"><th>color</th><th>name</th><th>HEX</th><th>RGB</th></tr>
                        <tr><td><div class="color-box" style="background: #FBB982"></div></td><td>Apricot</td><td>#FBB982</td><td>rgb(251, 185, 130)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #00B5BE"></div></td><td>Aquamarine</td><td>#00B5BE</td><td>rgb(0, 181, 190)</td></tr>
                        <tr><td><div class="color-box" style="background: #C04F17"></div></td><td>Bittersweet</td><td>#C04F17</td><td>rgb(192, 79, 23)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #221E1F"></div></td><td>Black</td><td>#221E1F</td><td>rgb(34, 30, 31)</td></tr>
                        <tr><td><div class="color-box" style="background: #2D2F92"></div></td><td>Blue</td><td>#2D2F92</td><td>rgb(45, 47, 146)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #00B3B8"></div></td><td>BlueGreen</td><td>#00B3B8</td><td>rgb(0, 179, 184)</td></tr>
                        <tr><td><div class="color-box" style="background: #473992"></div></td><td>BlueViolet</td><td>#473992</td><td>rgb(71, 57, 146)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #B6321C"></div></td><td>BrickRed</td><td>#B6321C</td><td>rgb(182, 50, 28)</td></tr>
                        <tr><td><div class="color-box" style="background: #792500"></div></td><td>Brown</td><td>#792500</td><td>rgb(121, 37, 0)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #F7921D"></div></td><td>BurntOrange</td><td>#F7921D</td><td>rgb(247, 146, 29)</td></tr>
                        <tr><td><div class="color-box" style="background: #74729A"></div></td><td>CadetBlue</td><td>#74729A</td><td>rgb(116, 114, 154)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #F282B4"></div></td><td>CarnationPink</td><td>#F282B4</td><td>rgb(242, 130, 180)</td></tr>
                        <tr><td><div class="color-box" style="background: #00A2E3"></div></td><td>Cerulean</td><td>#00A2E3</td><td>rgb(0, 162, 227)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #41B0E4"></div></td><td>CornflowerBlue</td><td>#41B0E4</td><td>rgb(65, 176, 228)</td></tr>
                        <tr><td><div class="color-box" style="background: #00AEEF"></div></td><td>Cyan</td><td>#00AEEF</td><td>rgb(0, 174, 239)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #FDBC42"></div></td><td>Dandelion</td><td>#FDBC42</td><td>rgb(253, 188, 66)</td></tr>
                        <tr><td><div class="color-box" style="background: #A4538A"></div></td><td>DarkOrchid</td><td>#A4538A</td><td>rgb(164, 83, 138)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #00A99D"></div></td><td>Emerald</td><td>#00A99D</td><td>rgb(0, 169, 157)</td></tr>
                        <tr><td><div class="color-box" style="background: #009B55"></div></td><td>ForestGreen</td><td>#009B55</td><td>rgb(0, 155, 85)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #8C368C"></div></td><td>Fuchsia</td><td>#8C368C</td><td>rgb(140, 54, 140)</td></tr>
                        <tr><td><div class="color-box" style="background: #FFDF42"></div></td><td>Goldenrod</td><td>#FFDF42</td><td>rgb(255, 223, 66)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #949698"></div></td><td>Gray</td><td>#949698</td><td>rgb(148, 150, 152)</td></tr>
                        <tr><td><div class="color-box" style="background: #00A64F"></div></td><td>Green</td><td>#00A64F</td><td>rgb(0, 166, 79)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #DFE674"></div></td><td>GreenYellow</td><td>#DFE674</td><td>rgb(223, 230, 116)</td></tr>
                        <tr><td><div class="color-box" style="background: #00A99A"></div></td><td>JungleGreen</td><td>#00A99A</td><td>rgb(0, 169, 154)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #F49EC4"></div></td><td>Lavender</td><td>#F49EC4</td><td>rgb(244, 158, 196)</td></tr>
                        <tr><td><div class="color-box" style="background: #8DC73E"></div></td><td>LimeGreen</td><td>#8DC73E</td><td>rgb(141, 199, 62)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #EC008C"></div></td><td>Magenta</td><td>#EC008C</td><td>rgb(236, 0, 140)</td></tr>
                        <tr><td><div class="color-box" style="background: #A9341F"></div></td><td>Mahogany</td><td>#A9341F</td><td>rgb(169, 52, 31)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #AF3235"></div></td><td>Maroon</td><td>#AF3235</td><td>rgb(175, 50, 53)</td></tr>
                        <tr><td><div class="color-box" style="background: #F89E7B"></div></td><td>Melon</td><td>#F89E7B</td><td>rgb(248, 158, 123)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #006795"></div></td><td>MidnightBlue</td><td>#006795</td><td>rgb(0, 103, 149)</td></tr>
                        <tr><td><div class="color-box" style="background: #A93C93"></div></td><td>Mulberry</td><td>#A93C93</td><td>rgb(169, 60, 147)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #006EB8"></div></td><td>NavyBlue</td><td>#006EB8</td><td>rgb(0, 110, 184)</td></tr>
                        <tr><td><div class="color-box" style="background: #3C8031"></div></td><td>OliveGreen</td><td>#3C8031</td><td>rgb(60, 128, 49)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #F58137"></div></td><td>Orange</td><td>#F58137</td><td>rgb(245, 129, 55)</td></tr>
                        <tr><td><div class="color-box" style="background: #ED135A"></div></td><td>OrangeRed</td><td>#ED135A</td><td>rgb(237, 19, 90)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #AF72B0"></div></td><td>Orchid</td><td>#AF72B0</td><td>rgb(175, 114, 176)</td></tr>
                        <tr><td><div class="color-box" style="background: #F7965A"></div></td><td>Peach</td><td>#F7965A</td><td>rgb(247, 150, 90)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #7977B8"></div></td><td>Periwinkle</td><td>#7977B8</td><td>rgb(121, 119, 184)</td></tr>
                        <tr><td><div class="color-box" style="background: #008B72"></div></td><td>PineGreen</td><td>#008B72</td><td>rgb(0, 139, 114)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #92268F"></div></td><td>Plum</td><td>#92268F</td><td>rgb(146, 38, 143)</td></tr>
                        <tr><td><div class="color-box" style="background: #00B0F0"></div></td><td>ProcessBlue</td><td>#00B0F0</td><td>rgb(0, 176, 240)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #99479B"></div></td><td>Purple</td><td>#99479B</td><td>rgb(153, 71, 155)</td></tr>
                        <tr><td><div class="color-box" style="background: #974006"></div></td><td>RawSienna</td><td>#974006</td><td>rgb(151, 64, 6)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #ED1B23"></div></td><td>Red</td><td>#ED1B23</td><td>rgb(237, 27, 35)</td></tr>
                        <tr><td><div class="color-box" style="background: #F26035"></div></td><td>RedOrange</td><td>#F26035</td><td>rgb(242, 96, 53)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #A1246B"></div></td><td>RedViolet</td><td>#A1246B</td><td>rgb(161, 36, 107)</td></tr>
                        <tr><td><div class="color-box" style="background: #EF559F"></div></td><td>Rhodamine</td><td>#EF559F</td><td>rgb(239, 85, 159)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #613F99"></div></td><td>RoyalBlue</td><td>#613F99</td><td>rgb(97, 63, 153)</td></tr>
                        <tr><td><div class="color-box" style="background: #ED017D"></div></td><td>RubineRed</td><td>#ED017D</td><td>rgb(237, 1, 125)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #F69289"></div></td><td>Salmon</td><td>#F69289</td><td>rgb(246, 146, 137)</td></tr>
                        <tr><td><div class="color-box" style="background: #3FBC9D"></div></td><td>SeaGreen</td><td>#3FBC9D</td><td>rgb(63, 188, 157)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #671800"></div></td><td>Sepia</td><td>#671800</td><td>rgb(103, 24, 0)</td></tr>
                        <tr><td><div class="color-box" style="background: #46C5DD"></div></td><td>SkyBlue</td><td>#46C5DD</td><td>rgb(70, 197, 221)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #C6DC67"></div></td><td>SpringGreen</td><td>#C6DC67</td><td>rgb(198, 220, 103)</td></tr>
                        <tr><td><div class="color-box" style="background: #DA9D76"></div></td><td>Tan</td><td>#DA9D76</td><td>rgb(218, 157, 118)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #00AEB3"></div></td><td>TealBlue</td><td>#00AEB3</td><td>rgb(0, 174, 179)</td></tr>
                        <tr><td><div class="color-box" style="background: #D883B7"></div></td><td>Thistle</td><td>#D883B7</td><td>rgb(216, 131, 183)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #00B4CE"></div></td><td>Turquoise</td><td>#00B4CE</td><td>rgb(0, 180, 206)</td></tr>
                        <tr><td><div class="color-box" style="background: #58429B"></div></td><td>Violet</td><td>#58429B</td><td>rgb(88, 66, 155)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #EF58A0"></div></td><td>VioletRed</td><td>#EF58A0</td><td>rgb(239, 88, 160)</td></tr>
                        <tr><td><div class="color-box" style="background: #FFFFFF"></div></td><td>White</td><td>#FFFFFF</td><td>rgb(255, 255, 255)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #EE2967"></div></td><td>WildStrawberry</td><td>#EE2967</td><td>rgb(238, 41, 103)</td></tr>
                        <tr><td><div class="color-box" style="background: #FFF200"></div></td><td>Yellow</td><td>#FFF200</td><td>rgb(255, 242, 0)</td></tr>
                        <tr style="background: #F2F2F2"><td><div class="color-box" style="background: #98CC70"></div></td><td>YellowGreen</td><td>#98CC70</td><td>rgb(152, 204, 112)</td></tr>
                        <tr><td><div class="color-box" style="background: #FAA21A"></div></td><td>YellowOrange</td><td>#FAA21A</td><td>rgb(250, 162, 26)</td></tr>
                    </tbody></table>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>

    <script>
        const inputEl = document.getElementById('latex-input');
        const outputEl = document.getElementById('latex-output');

        // --- RENDER LOGIC ---
        function updateRender() {
            const latexString = inputEl.value;
            if (!latexString.trim()) {
                outputEl.innerHTML = '';
                return;
            }
            try {
                katex.render(latexString, outputEl, {
                    throwOnError: false,
                    displayMode: true
                });
            } catch (err) {
                outputEl.textContent = "Error rendering LaTeX";
            }
        }

        // Helper function to insert text at the cursor
        function insertTextAtCursor(text) {
            const start = inputEl.selectionStart;
            const end = inputEl.selectionEnd;
            const currentText = inputEl.value;
            
            inputEl.value = currentText.substring(0, start) + text + currentText.substring(end);
            
            // Move cursor to the end of the inserted text
            inputEl.selectionStart = inputEl.selectionEnd = start + text.length;
            inputEl.focus();
            updateRender();
        }

        // --- PIECEWISE FUNCTION LOGIC ---
        document.getElementById('insert-piecewise-btn').addEventListener('click', () => {
            const insertText = "\\begin{cases}\n    \n\\end{cases}";
            const start = inputEl.selectionStart;
            const end = inputEl.selectionEnd;
            const currentText = inputEl.value;
            
            // Rebuild string with the snippet
            inputEl.value = currentText.substring(0, start) + insertText + currentText.substring(end);
            
            // Place cursor exactly at the indented line (13 characters for \begin{cases} + 1 newline + 4 spaces = 18)
            const cursorPosition = start + 18;
            inputEl.selectionStart = inputEl.selectionEnd = cursorPosition;
            
            inputEl.focus();
            updateRender();
        });

        // --- AUTO-CLOSE & TAB LOGIC ---
        inputEl.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                const cursorPos = this.selectionStart;
                const textBeforeCursor = this.value.substring(0, cursorPos);
                const match = textBeforeCursor.match(/\\begin\{([^}]+)\}$/);

                if (match) {
                    e.preventDefault();
                    const envName = match[1];
                    const textAfterCursor = this.value.substring(this.selectionEnd);
                    const insertText = '\n    \n\\end{' + envName + '}';
                    
                    this.value = textBeforeCursor + insertText + textAfterCursor;
                    this.selectionStart = this.selectionEnd = cursorPos + 5;
                    updateRender();
                }
            }
            
            if (e.key === 'Tab') {
                e.preventDefault();
                const start = this.selectionStart;
                const end = this.selectionEnd;
                this.value = this.value.substring(0, start) + "    " + this.value.substring(end);
                this.selectionStart = this.selectionEnd = start + 4;
            }
        });

        // Trigger render on typing
        inputEl.addEventListener('input', updateRender);

        // --- RENDER MATRIX PREVIEWS IN THE MODAL ---
        document.querySelectorAll('.matrix-preview').forEach(el => {
            const latexToRender = el.getAttribute('data-latex');
            katex.render(latexToRender, el, {
                throwOnError: false,
                displayMode: true
            });
        });

        // --- MATRICES MODAL LOGIC ---
        const matrixModal = document.getElementById('matrix-modal');
        const openMatrixBtn = document.getElementById('open-matrix-btn');
        const closeMatrixBtn = document.getElementById('close-matrix-btn');
        const closeMatrixX = document.getElementById('close-matrix-x');
        const applyMatrixBtn = document.getElementById('apply-matrix-btn');

        function closeMatrix() { matrixModal.style.display = 'none'; }

        openMatrixBtn.addEventListener('click', () => { matrixModal.style.display = 'flex'; });
        closeMatrixBtn.addEventListener('click', closeMatrix);
        closeMatrixX.addEventListener('click', closeMatrix);

        applyMatrixBtn.addEventListener('click', () => {
            const selectedRadio = document.querySelector('input[name="matrix-type"]:checked');
            const matrixType = selectedRadio ? selectedRadio.value : 'pmatrix';
            
            const rows = parseInt(document.getElementById('mat-rows').value) || 3;
            const cols = parseInt(document.getElementById('mat-cols').value) || 3;

            let generatedLatex = `\\begin{${matrixType}}\n`;
            
            for (let r = 0; r < rows; r++) {
                let rowString = "    ";
                for (let c = 0; c < cols; c++) {
                    rowString += "  "; 
                    if (c < cols - 1) {
                        rowString += " & ";
                    }
                }
                if (r < rows - 1) {
                    rowString += " \\\\";
                }
                generatedLatex += rowString + "\n";
            }
            generatedLatex += `\\end{${matrixType}}\n`;

            closeMatrix();
            insertTextAtCursor(generatedLatex);
        });

        // --- CHEATSHEET MODAL LOGIC ---
        const cheatsheetModal = document.getElementById('cheatsheet-modal');
        const openCheatsheetBtn = document.getElementById('open-cheatsheet-btn');
        const closeCheatsheetBtn = document.getElementById('close-cheatsheet-btn');

        openCheatsheetBtn.addEventListener('click', () => { cheatsheetModal.style.display = 'flex'; });
        closeCheatsheetBtn.addEventListener('click', () => { cheatsheetModal.style.display = 'none'; });

        // Close either modal by clicking the grey background
        window.addEventListener('click', (e) => {
            if (e.target === matrixModal) closeMatrix();
            if (e.target === cheatsheetModal) cheatsheetModal.style.display = 'none';
        });

        // Clear default text to let the placeholder shine
        inputEl.value = "";
        updateRender();
    </script>

</body>
</html>